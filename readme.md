# Instahyre Spam Detection & Contact Search API - Coding Test

## Prerequisites

*   Python (3.8+ recommended)
*   Django 3.2+
*   pip (Python package installer)
*   Faker (for generating fake data)

## Features
- **User Authentication**: Users can register, log, view-porfile, edit-profile with JWT-based auth.
- **Search User**: Search with name or phone number and results in return of user's details with their spam likelihood
- **Spam Likelihood**: Users can see spam likelihood of the particular phone number.
- **Spam Reporting**: Users can mark phone numbers as spam.

## Setup Instructions

### 1. Create a virtual environment

Create and activate a virtual environment to isolate your project dependencies.

```bash
python -m venv .venv
source .venv/bin/activate  # For Linux/MacOS
.venv\Scripts\activate     # For Windows
```

### 2. Install dependencies

```bash
pip install -r requirements.txt
```

### 3. Set up the database

Run the migrations to set up the database schema.

```bash
python manage.py makemigrations
python manage.py migrate
```

### 4. Populate database with data generated by Faker
```bash
python manage.py populate_data
```

### 5. Start the development server
```bash
python manage.py runserver
```

# API Endpoints Overview

All endpoints require authentication (Token-based) unless otherwise specified.  
Send your token in the `Authorization` header:

---

Authorization: Token <your_token_here>

---

## Authentication & User Management (`/auth/`)

### `POST /auth/register/`
- **Description:** User registration.
- **Auth:** None.
- **Request Body:**
```json
{
  "name": "John Doe",
  "phone_number": "+1234567890",
  "password": "yourpassword",
  "password_confirm": "yourpassword",
  "email": "john.doe@example.com" // optional
}
```

### `POST /auth/login/`
- **Description:** User login.
- **Auth:** None.
- **Request Body:**
```json
{
  "username": "+1234567890",
  "password": "yourpassword"
}
```
- **Response:** Includes token, user_id, name, etc.

### `POST /auth/logout/`
- **Description:** User logout (invalidates token).
- **Auth:** Token Required.

### `GET /auth/profile/`
- **Description:** View own profile.
- **Auth:** Token Required.

### `PUT /auth/profile/`
- **Description:** Update own profile (name, email).
- **Auth:** Token Required.
- **Request Body:** 
```json
{
  "name": "Johnny Doe",
  "email": "johnny.d@example.com"
}
```
## Core API (`/api/`)

### `POST /api/spam/mark/`
- **Description:** Mark a phone number as spam.
- **Auth:** Token Required.
- **Request Body:**
```json
{
  "phone_number": "+9876543210"
}
```

### `GET /api/search/name/?q=<search_query>`
- **Description:** Search by name.  
  *(e.g., `/api/search/name/?q=John`)*
- **Auth:** Token Required.
- **Response:** List of results with:
  - `name`
  - `phone_number`
  - `spam_likelihood`
  - `conditional email`

> Results are sorted by "starts with" then "contains".

### `GET /api/search/phone/?phone=<phone_number>`
- **Description:** Search by phone number.  
  *(e.g., `/api/search/phone/?phone=1234567890`)*
- **Auth:** Token Required.
- **Response:** Resulted contact entry.

## Testing the API

You can use tools like **Postman**, **Insomnia**, or `curl` to interact with the API.

### Steps to test:

1. **Register a new user** using the `/auth/register/` endpoint.
2. **Login** with the new user's credentials via `/auth/login/` to obtain an authentication token.
3. Use this **token** in the `Authorization` header for all authenticated requests:
   ```
   Authorization: Token <your_token_here>
   ```
4. **Test the following:**
   - Mark phone numbers as spam using `/api/spam/mark/`.
   - Search by name and phone number using:
     - `/api/search/name/?q=<query>`
     - `/api/search/phone/?phone=<number>`
   - View and update the user profile via `/auth/profile/`.
   - Logout using `/auth/logout/` to invalidate the token.
5. Use the `populate_data` script to add test data, and observe:
   - Spam likelihood scores.
   - Conditional email visibility based on spam rules.
